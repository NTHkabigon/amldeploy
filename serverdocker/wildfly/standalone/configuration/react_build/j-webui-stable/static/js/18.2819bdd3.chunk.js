(this["webpackJsonpstable-app"]=this["webpackJsonpstable-app"]||[]).push([[18],{80:function(e,t,s){"use strict";s.r(t);var i=s(0),o=s.n(i),a=s(1),l=s(6),r=s(4);let n=Object(r.b)("jwebui_roleMatrix"),c=Object(r.b)("jwebui_role_matrix_manager");class d extends i.Component{constructor(e){var t;super(e),this.changeKeyLanguage=e=>{let t={note:a.g.getLang("note"),title_:a.g.getLang("roleMatrix_title"),des_:a.g.getLang("roleMatrix_des"),function:a.g.getLang("roleMatrix_function"),role:a.g.getLang("roleMatrix_role"),power:a.g.getLang("roleMatrix_power"),rolesearch:a.g.getLang("roleMatrix_rolesearch"),permissionsearch:a.g.getLang("roleMatrix_permissionsearch"),access_function:a.g.getLang("roleMatrix_accessFunction"),data_monitoring:a.g.getLang("roleMatrix_dataMonitoring"),decentralized_objects:a.g.getLang("roleMatrix_decentralizedObjects"),constructor:a.g.getLang("roleMatrix_constructor"),set_up_power:a.g.getLang("roleMatrix_setUpPower")};if(void 0!==e)return t;let s=this.stateHidden.infoA;s.title=a.g.getLang("roleMatrix_title"),s.des=a.g.getLang("roleMatrix_des"),s.lang_form.vi=a.g.getLang("roleMatrix_title"),s.lang_form.en=a.g.getLang("roleMatrix_title"),this.stateHidden.infoA=s,this.stateHidden.languages=t,this.setState({lang_key:a.g.getLangKey()}),this.changeLanguageTemplate(t)},this.getInfoA=()=>this.stateHidden.infoA,this.getKeyFormAuto=()=>this.key_form,this.callSetHidden=e=>{this.stateHidden.hidden="none"===e,this.setState({reload:!0})},this.abs_search_role=e=>{let t=this.state.stateData;t.role_search.value=e.target.value,t.listButton=this.ROLE_SYSTEM.filter(t=>{let s=t.role_system.role_system_name.toLowerCase(),i=e.target.value.toLowerCase();return s.includes(i)}).map((e,t)=>({dataFull:{config:{default:{title:e.role_system.role_system_name,type:0===t?"primary":"",class:"col-sm-12"}},dataItem:{id:e.role_system.role_system_id}},abs_Click:this.abs_select_role})),this.setState({stateData:t})},this.abs_search_form=e=>{let t=e.target.value,s=this.state.stateData,i=this.MENU_TEMPLATE.filter(e=>e.title.toLowerCase().includes(t.toLowerCase()));this.list_menu_id=i.map(e=>e.id),i=this.getListMenuChild(i),i=this.getListMenuParent(i),s.form_search.value=t,s.listTreeItem.tree_data=i,this.setState({stateData:s,form_search:""})},this.abs_select_item_menu=(e,t)=>{const s=t.dataItem.menu.group_menu.group_menu_function_code,i=this.state.role_select;this.onCallForm(s,i)},this.abs_select_role=(e,t)=>{let s=this.state.stateData;for(let i of s.listButton)i.dataFull.dataItem.id===t.id?i.dataFull.config.default.type="primary":i.dataFull.config.default.type="";this.setState({stateData:s,role_select:t.id},()=>{const e=this.state.form_select,t=this.state.role_select;this.onCallForm(e,t)})},this.abs_Click_check_access_function=e=>{let t=this.stateHidden.form_role;t[this.state.role_select][this.state.form_select].form.accept=!t[this.state.role_select][this.state.form_select].form.accept;let s=this.stateHidden.form_config.list_layout;for(const i in s){let e=s[i];void 0===t[this.state.role_select][e.codeHidden]&&(t[this.state.role_select][e.codeHidden]={layout:{install:!0}});for(const s in e.list_view){let i=e.list_view[s];void 0===t[this.state.role_select][i.codeHidden]&&(t[this.state.role_select][i.codeHidden]={view:{install:!0}});for(const e in i.list_input){let s=i.list_input[e];void 0===t[this.state.role_select][s.default.codeHidden]&&(t[this.state.role_select][s.default.codeHidden]={component:{install:!0}})}}}l.b([{txcode:"#sys:bo-save-roleMatrix",input:{form_id:this.state.form_select,content:JSON.stringify(t),role_select:this.state.role_select}}],{}).then(e=>{this.onCallForm(this.state.form_select,this.state.role_select)})},this.abs_Click_check_role_contructor=e=>{let t=this.stateHidden.form_role;t[this.state.role_select][e.codeHidden]={[e.type]:{install:!e.constructor}};let s=this.stateHidden.form_config.list_layout;switch(e.type){case"layout":for(const i in s){let o=s[i];if(o.codeHidden===e.codeHidden){for(const s in o.list_view){let i=o.list_view[s];t[this.state.role_select][i.codeHidden]={view:{install:!e.constructor}};for(const s in i.list_input){let o=i.list_input[s];t[this.state.role_select][o.default.codeHidden]={component:{install:!e.constructor}}}}break}}break;case"view":for(const i in s){let o=s[i];for(const s in o.list_view){let i=o.list_view[s];if(i.codeHidden===e.codeHidden){t[this.state.role_select][i.codeHidden]={view:{install:!e.constructor}};for(const s in i.list_input){let o=i.list_input[s];t[this.state.role_select][o.default.codeHidden]={component:{install:!e.constructor}}}break}}}}l.b([{txcode:"#sys:bo-save-roleMatrix",input:{form_id:this.state.form_select,content:JSON.stringify(t),role_select:this.state.role_select}}],{}).then(e=>{this.onCallForm(this.state.form_select,this.state.role_select)})},this.getMenuTreeTemplate=()=>this.DATA_MENU.map(e=>({title:e.group_menu.group_menu_name||"#ERROR",parent_id:e.group_menu.group_menu_parent,is_open:!1,DOM_elm:null,id:e.group_menu.group_menu_id,dataItem:{menu:e},abs_click:this.abs_select_item_menu})),this.getCheckboxTreeTemplate=(e,t)=>({abs_Click_check_access_function:this.abs_Click_check_access_function,access_function:(null===t||void 0===t?void 0:t[e.info.form_code].form.accept)||!1,data_monitoring:(null===t||void 0===t?void 0:t[e.info.form_code].form.follow)||!1,list_layout:e.list_layout.map(e=>{var s,i;return{dataItem:{type:"layout",codeHidden:e.codeHidden,constructor:(null===t||void 0===t||null===(s=t[e.codeHidden])||void 0===s?void 0:s.layout.install)||!1,permission:!1},name:e.name||"Layout: #NO_NAME",abs_Click_constructor:this.abs_Click_check_role_contructor,constructor:(null===t||void 0===t||null===(i=t[e.codeHidden])||void 0===i?void 0:i.layout.install)||!1,permission:!1,default:e.default,list_view:e.list_view.map(e=>{var s,i;return{dataItem:{type:"view",codeHidden:e.codeHidden,constructor:(null===t||void 0===t||null===(s=t[e.codeHidden])||void 0===s?void 0:s.view.install)||!1,permission:!1},name:e.name||"View: #NO_NAME",abs_Click_constructor:this.abs_Click_check_role_contructor,constructor:(null===t||void 0===t||null===(i=t[e.codeHidden])||void 0===i?void 0:i.view.install)||!1,permission:!1,default:e.default,list_input:e.list_input.map(e=>{var s,i;return{dataItem:{type:"component",codeHidden:e.default.codeHidden,constructor:(null===t||void 0===t||null===(s=t[e.default.codeHidden])||void 0===s?void 0:s.component.install)||!1,permission:!1},abs_Click_constructor:this.abs_Click_check_role_contructor,constructor:(null===t||void 0===t||null===(i=t[e.default.codeHidden])||void 0===i?void 0:i.component.install)||!1,permission:!1,default:e.default}})}})}})}),this.key_form="roleMatrix",this.DATA_MENU=a.g.getData("group_menu").sort((function(e,t){return e.group_menu.group_menu_order-t.group_menu.group_menu_order})),this.MENU_TEMPLATE=this.getMenuTreeTemplate(),this.ROLE_SYSTEM=a.g.getData("role_system");let s=this.changeKeyLanguage("start");this.stateHidden={infoA:{lang_form:{vi:a.g.getLang("roleMatrix_title"),en:a.g.getLang("roleMatrix_title")},title:"Permissions System",des:"H\u1ec7 th\u1ed1ng ph\xe2n quy\u1ec1n to\xe0n \u1ee9ng d\u1ee5ng!",openOne:"true",ofModal:!1},languages:s,role_task_tree:{},form_config:{},form_role:{},hidden:!1,role_filter:this.ROLE_SYSTEM,menu_filter:this.DATA_MENU},this.state={lang_key:a.g.getLangKey(),form_select:"",role_select:null===(t=this.ROLE_SYSTEM[0])||void 0===t?void 0:t.role_system.role_system_id,role_search:"",form_search:"",stateData:{form:{dataFull:{config:{default:{title:s.title_,title_sub:s.des_}},cmd:{visibility:""}}},role:{title:s.role},role_search:{placeholder:s.rolesearch,value:"",abs_search:this.abs_search_role},permission:{title:s.power},form_search:{placeholder:s.permissionsearch,value:"",abs_search:this.abs_search_form},listButton:this.ROLE_SYSTEM.map((e,t)=>({dataFull:{config:{default:{title:e.role_system.role_system_name,type:0===t?"primary":"",class:"col-sm-12"}},dataItem:{id:e.role_system.role_system_id}},abs_Click:this.abs_select_role})),listTreeItem:{tree_data:this.MENU_TEMPLATE,config:{open_one:!0,is_has_dom:!0}}}}}changeLanguageTemplate(e){let{stateData:t}=this.state;t.form.dataFull.config.default.title=e.title_,t.form.dataFull.config.default.title_sub=e.des_,t.role.title=e.role,t.role_search.placeholder=e.rolesearch,t.permission.title=e.power,t.form_search.placeholder=e.permissionsearch,this.setState({stateData:t})}componentWillMount(){this.state.stateData.listTreeItem.tree_data[0].DOM_elm=o.a.createElement(c,{dataFull:{access_function:!1,data_monitoring:!1,list_layout:[]},key:"no"})}componentDidMount(){a.g.addAppAuto(this.key_form,this,this.stateHidden.infoA.ofModal),a.g.form_addMapping(this.key_form,this.props.mapping_key)}getListMenuParent(e){for(const t of e)e=e.concat(this.getMenuTreeTemplate().filter(e=>e.id===t.parent_id&&!1===this.list_menu_id.includes(e.id)&&(this.list_menu_id.push(e.id),!0)));return e}getListMenuChild(e){for(const t of e)e=e.concat(this.getMenuTreeTemplate().filter(e=>e.parent_id===t.id&&!1===this.list_menu_id.includes(e.id)&&(this.list_menu_id.push(e.id),!0)));return e}convertRoleTaskTree(e){let t=this.state.role_select,s=this.state.form_select,i={[t]:{[s]:{form:{accept:!1,follow:!1}}}};return e.list_layout.forEach(e=>{i[t][e.codeHidden]={layout:{install:!0}},e.list_view.forEach(e=>{i[t][e.codeHidden]={view:{install:!0}},e.list_input.forEach(e=>{i[t][e.default.codeHidden]={component:{install:!0}}})})}),i}onCallForm(e,t){e&&t&&Object(l.b)([{txcode:"#sys:bo-load-formRole",input:{form_id:e}},{txcode:"#sys:bo-load-formId",input:{form_id:e}}],{}).then(s=>{var i=a.g.foGetData("form_design_detail",s);void 0===i&&(i={info:{form_code:e},list_layout:[]});var l=a.g.foGetData("loadRoleTask",s)||{};void 0===l[t]&&(l[t]={[e]:{form:{accept:!1,follow:!1}}});let r=this.state.stateData,n=r.listTreeItem.tree_data;for(let a of n)if(a.dataItem.menu.group_menu.group_menu_function_code===e){let s=this.getCheckboxTreeTemplate(i,l[t]);this.stateHidden.role_task_tree=s,a.DOM_elm=o.a.createElement(c,{dataFull:s,key:e})}r.listTreeItem.tree_data=n,this.stateHidden.form_config=i,this.stateHidden.form_role=l,this.setState({form_select:e,stateData:r})},e=>{})}render(){return o.a.createElement("div",{style:{display:this.stateHidden.hidden?"none":""}},o.a.createElement(n,{stateData:this.state.stateData}))}}t.default=d}}]);